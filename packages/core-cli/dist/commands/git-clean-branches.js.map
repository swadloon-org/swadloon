{"version":3,"sources":["../../src/commands/git-clean-branches.ts"],"sourcesContent":["import { Config, Flags } from '@oclif/core';\nimport simpleGit from 'simple-git';\n\nimport { BaseCommand } from '../base-command.js';\n\nexport default class GitCleanBranches extends BaseCommand {\n  static description = 'delete local branches that are already merged on origin';\n\n  static examples = [`$ nr git-clean-branches`];\n\n  static flags = {\n    help: Flags.help({ char: 'h' }),\n  };\n\n  static args = [];\n\n  constructor(argv: string[], config: Config) {\n    super(argv, config, { name: 'git-clean-branches' });\n  }\n\n  async init() {}\n\n  async run() {\n    const git = simpleGit();\n\n    this.log('looking for local branches to remove');\n\n    const localBranches = await git.branchLocal();\n    this.log(`local branches: ${localBranches.all.map((branch) => this.chalk.blueBright(branch))}`);\n\n    const ignoredBranches = ['dev', 'master', 'release'];\n    this.log(`ignored: ${ignoredBranches.map((branch) => this.chalk.blueBright(branch))}`);\n\n    const mergedToMasterBranches = await git.branch(['--merged', 'master']);\n    this.log(`branches merged on master: ${mergedToMasterBranches.all}`);\n\n    const localBranchesToBeDeleted = localBranches.all\n      .filter((localBranch) => mergedToMasterBranches.all.includes(localBranch))\n      .filter((branch) => !ignoredBranches.includes(branch));\n    this.log(\n      `to remove: ${\n        localBranchesToBeDeleted.length\n          ? localBranchesToBeDeleted.map((branch) => this.chalk.red(branch))\n          : '[]'\n      }`\n    );\n\n    if (!localBranchesToBeDeleted.length) {\n      this.log(`no branches to remove âœ…`);\n      return;\n    }\n\n    localBranchesToBeDeleted.map(async (branchToRemove) => {\n      this.log(`removing ${branchToRemove}`);\n      const removed = await git.branch([`-d`, branchToRemove]);\n    });\n  }\n}\n"],"names":["GitCleanBranches","BaseCommand","description","examples","flags","help","Flags","char","args","constructor","argv","config","name","init","run","git","simpleGit","log","localBranches","branchLocal","all","map","branch","chalk","blueBright","ignoredBranches","mergedToMasterBranches","localBranchesToBeDeleted","filter","localBranch","includes","length","red","branchToRemove","removed"],"mappings":"AAAA;;;;;AAA8B,IAAA,KAAa,WAAb,aAAa,CAAA;AACrB,IAAA,UAAY,kCAAZ,YAAY,EAAA;AAEN,IAAA,cAAoB,WAApB,oBAAoB,CAAA;AAEjC,MAAMA,gBAAgB,SAASC,cAAW,YAAA;IACvD,OAAOC,WAAW,GAAG,yDAAyD,CAAC;IAE/E,OAAOC,QAAQ,GAAG;QAAC,CAAC,uBAAuB,CAAC;KAAC,CAAC;IAE9C,OAAOC,KAAK,GAAG;QACbC,IAAI,EAAEC,KAAK,MAAA,CAACD,IAAI,CAAC;YAAEE,IAAI,EAAE,GAAG;SAAE,CAAC;KAChC,CAAC;IAEF,OAAOC,IAAI,GAAG,EAAE,CAAC;IAEjBC,YAAYC,IAAc,EAAEC,MAAc,CAAE;QAC1C,KAAK,CAACD,IAAI,EAAEC,MAAM,EAAE;YAAEC,IAAI,EAAE,oBAAoB;SAAE,CAAC,CAAC;KACrD;IAED,MAAMC,IAAI,GAAG,EAAE;IAEf,MAAMC,GAAG,GAAG;QACV,MAAMC,GAAG,GAAGC,CAAAA,GAAAA,UAAS,AAAE,CAAA,QAAF,EAAE,AAAC;QAExB,IAAI,CAACC,GAAG,CAAC,sCAAsC,CAAC,CAAC;QAEjD,MAAMC,aAAa,GAAG,MAAMH,GAAG,CAACI,WAAW,EAAE,AAAC;QAC9C,IAAI,CAACF,GAAG,CAAC,CAAC,gBAAgB,EAAEC,aAAa,CAACE,GAAG,CAACC,GAAG,CAAC,CAACC,MAAM,GAAK,IAAI,CAACC,KAAK,CAACC,UAAU,CAACF,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAEhG,MAAMG,eAAe,GAAG;YAAC,KAAK;YAAE,QAAQ;YAAE,SAAS;SAAC,AAAC;QACrD,IAAI,CAACR,GAAG,CAAC,CAAC,SAAS,EAAEQ,eAAe,CAACJ,GAAG,CAAC,CAACC,MAAM,GAAK,IAAI,CAACC,KAAK,CAACC,UAAU,CAACF,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAEvF,MAAMI,sBAAsB,GAAG,MAAMX,GAAG,CAACO,MAAM,CAAC;YAAC,UAAU;YAAE,QAAQ;SAAC,CAAC,AAAC;QACxE,IAAI,CAACL,GAAG,CAAC,CAAC,2BAA2B,EAAES,sBAAsB,CAACN,GAAG,CAAC,CAAC,CAAC,CAAC;QAErE,MAAMO,wBAAwB,GAAGT,aAAa,CAACE,GAAG,CAC/CQ,MAAM,CAAC,CAACC,WAAW,GAAKH,sBAAsB,CAACN,GAAG,CAACU,QAAQ,CAACD,WAAW,CAAC,CAAC,CACzED,MAAM,CAAC,CAACN,MAAM,GAAK,CAACG,eAAe,CAACK,QAAQ,CAACR,MAAM,CAAC,CAAC,AAAC;QACzD,IAAI,CAACL,GAAG,CACN,CAAC,WAAW,EACVU,wBAAwB,CAACI,MAAM,GAC3BJ,wBAAwB,CAACN,GAAG,CAAC,CAACC,MAAM,GAAK,IAAI,CAACC,KAAK,CAACS,GAAG,CAACV,MAAM,CAAC,CAAC,GAChE,IAAI,CACT,CAAC,CACH,CAAC;QAEF,IAAI,CAACK,wBAAwB,CAACI,MAAM,EAAE;YACpC,IAAI,CAACd,GAAG,CAAC,CAAC,yBAAuB,CAAC,CAAC,CAAC;YACpC,OAAO;SACR;QAEDU,wBAAwB,CAACN,GAAG,CAAC,OAAOY,cAAc,GAAK;YACrD,IAAI,CAAChB,GAAG,CAAC,CAAC,SAAS,EAAEgB,cAAc,CAAC,CAAC,CAAC,CAAC;YACvC,MAAMC,OAAO,GAAG,MAAMnB,GAAG,CAACO,MAAM,CAAC;gBAAC,CAAC,EAAE,CAAC;gBAAEW,cAAc;aAAC,CAAC,AAAC;SAC1D,CAAC,CAAC;KACJ;CACF;kBApDoBjC,gBAAgB"}