{"version":3,"sources":["../../src/commands/vercel-deploy.ts"],"sourcesContent":["import { spawnSync } from 'child_process';\n\nimport { Command, Config, Flags } from '@oclif/core';\nimport * as t from 'io-ts';\n\nimport { getShellForPlatform, loadDotEnv } from '@newrade/core-node-utils';\n\nimport { BaseCommand } from '../base-command.js';\n\nexport type ENV = t.TypeOf<typeof Env>;\nexport const Env = t.intersection([\n  t.type({}),\n  t.type({\n    VERCEL_PROJECT_ID: t.string,\n    VERCEL_ORG_ID: t.string,\n    VERCEL_TOKEN: t.string,\n    VERCEL_SCOPE: t.string,\n  }),\n]);\n\nexport default class VercelDeploy extends BaseCommand {\n  static description = 'deploy site with vercel using env variables';\n\n  static examples = [`$ nr vercel-deploy`];\n\n  static flags = {\n    help: Flags.help({ char: 'h' }),\n  };\n\n  static args = [];\n\n  constructor(argv: string[], config: Config) {\n    super(argv, config, { name: 'vercel-deploy' });\n  }\n\n  async init() {}\n\n  async run() {\n    this.log(`running in ${process.cwd()}`);\n    this.log('validating env variables');\n    this.log('loading .env file');\n\n    const env = loadDotEnv<ENV>({\n      schema: Env,\n      dotEnvPath: '.env',\n      dotEnvRootPath: '../../.env',\n      packageName: 'core-cli',\n    });\n\n    this.log('running vercel deploy');\n\n    // use yarn to use the locally installed vercel-cli\n    spawnSync(`yarn vercel public --token $VERCEL_TOKEN --scope $VERCEL_SCOPE --confirm`, {\n      cwd: '.',\n      shell: getShellForPlatform(),\n      stdio: 'inherit',\n      env: env,\n    });\n\n    this.log('done! âœ…');\n  }\n}\n"],"names":["t","VercelDeploy","BaseCommand","description","examples","flags","help","Flags","char","args","constructor","argv","config","name","init","run","log","process","cwd","env","loadDotEnv","schema","Env","dotEnvPath","dotEnvRootPath","packageName","spawnSync","shell","getShellForPlatform","stdio","intersection","type","VERCEL_PROJECT_ID","string","VERCEL_ORG_ID","VERCEL_TOKEN","VERCEL_SCOPE"],"mappings":"AAAA;;;;;AAA0B,IAAA,aAAe,WAAf,eAAe,CAAA;AAEF,IAAA,KAAa,WAAb,aAAa,CAAA;AACxCA,IAAAA,CAAC,mCAAM,OAAO,EAAb;AAEmC,IAAA,cAA0B,WAA1B,0BAA0B,CAAA;AAE9C,IAAA,cAAoB,WAApB,oBAAoB,CAAA;AAajC,MAAMC,YAAY,SAASC,cAAW,YAAA;IACnD,OAAOC,WAAW,GAAG,6CAA6C,CAAC;IAEnE,OAAOC,QAAQ,GAAG;QAAC,CAAC,kBAAkB,CAAC;KAAC,CAAC;IAEzC,OAAOC,KAAK,GAAG;QACbC,IAAI,EAAEC,KAAK,MAAA,CAACD,IAAI,CAAC;YAAEE,IAAI,EAAE,GAAG;SAAE,CAAC;KAChC,CAAC;IAEF,OAAOC,IAAI,GAAG,EAAE,CAAC;IAEjBC,YAAYC,IAAc,EAAEC,MAAc,CAAE;QAC1C,KAAK,CAACD,IAAI,EAAEC,MAAM,EAAE;YAAEC,IAAI,EAAE,eAAe;SAAE,CAAC,CAAC;KAChD;IAED,MAAMC,IAAI,GAAG,EAAE;IAEf,MAAMC,GAAG,GAAG;QACV,IAAI,CAACC,GAAG,CAAC,CAAC,WAAW,EAAEC,OAAO,CAACC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;QACxC,IAAI,CAACF,GAAG,CAAC,0BAA0B,CAAC,CAAC;QACrC,IAAI,CAACA,GAAG,CAAC,mBAAmB,CAAC,CAAC;QAE9B,MAAMG,GAAG,GAAGC,CAAAA,GAAAA,cAAU,AAKpB,CAAA,WALoB,CAAM;YAC1BC,MAAM,EAAEC,GAAG;YACXC,UAAU,EAAE,MAAM;YAClBC,cAAc,EAAE,YAAY;YAC5BC,WAAW,EAAE,UAAU;SACxB,CAAC,AAAC;QAEH,IAAI,CAACT,GAAG,CAAC,uBAAuB,CAAC,CAAC;QAElC,mDAAmD;QACnDU,CAAAA,GAAAA,aAAS,AAKP,CAAA,UALO,CAAC,CAAC,wEAAwE,CAAC,EAAE;YACpFR,GAAG,EAAE,GAAG;YACRS,KAAK,EAAEC,CAAAA,GAAAA,cAAmB,AAAE,CAAA,oBAAF,EAAE;YAC5BC,KAAK,EAAE,SAAS;YAChBV,GAAG,EAAEA,GAAG;SACT,CAAC,CAAC;QAEH,IAAI,CAACH,GAAG,CAAC,cAAS,CAAC,CAAC;KACrB;CACF;kBAzCoBf,YAAY;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAV1B,MAAMqB,GAAG,GAAGtB,CAAC,CAAC8B,YAAY,CAAC;IAChC9B,CAAC,CAAC+B,IAAI,CAAC,EAAE,CAAC;IACV/B,CAAC,CAAC+B,IAAI,CAAC;QACLC,iBAAiB,EAAEhC,CAAC,CAACiC,MAAM;QAC3BC,aAAa,EAAElC,CAAC,CAACiC,MAAM;QACvBE,YAAY,EAAEnC,CAAC,CAACiC,MAAM;QACtBG,YAAY,EAAEpC,CAAC,CAACiC,MAAM;KACvB,CAAC;CACH,CAAC,AAAC;QARUX,GAAG,GAAHA,GAAG"}