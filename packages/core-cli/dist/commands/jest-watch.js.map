{"version":3,"sources":["../../src/commands/jest-watch.ts"],"sourcesContent":["import { spawnSync } from 'child_process';\n\nimport { Config, Flags } from '@oclif/core';\n\nimport { getShellForPlatform } from '@newrade/core-node-utils';\n\nimport { BaseCommand } from '../base-command.js';\n\nexport default class JestWatch extends BaseCommand {\n  static description = 'Shortcut to run jest with typescript (ts-node)';\n\n  static examples = [`$ nr jest`];\n\n  static args = [{ name: 'args' }];\n\n  static flags = {\n    config: Flags.string({ description: 'path to jest config file', default: 'jest.config.ts' }),\n  };\n\n  constructor(argv: string[], config: Config) {\n    super(argv, config, { name: 'jest' });\n  }\n\n  async run() {\n    const { args, flags } = await this.parse(JestWatch);\n\n    const command = [\n      `cross-env TS_NODE_PROJECT=../../tsconfig.node-cli.json node -r ts-node/register ../../node_modules/jest/bin/jest`,\n      `${flags.config ? '--config ' + flags.config : ''}`,\n      `${args.args || '--watch'}`,\n    ].join(' ');\n\n    this.log(`running: ${command}`);\n\n    const cmd = spawnSync(command, {\n      shell: getShellForPlatform(),\n      stdio: ['inherit', 'inherit', 'inherit'], // jest only uses stderr as output https://github.com/facebook/jest/issues/5064\n      env: process.env,\n    });\n  }\n}\n"],"names":["JestWatch","BaseCommand","description","examples","args","name","flags","config","Flags","string","default","constructor","argv","run","parse","command","join","log","cmd","spawnSync","shell","getShellForPlatform","stdio","env","process"],"mappings":"AAAA;;;;;AAA0B,IAAA,aAAe,WAAf,eAAe,CAAA;AAEX,IAAA,KAAa,WAAb,aAAa,CAAA;AAEP,IAAA,cAA0B,WAA1B,0BAA0B,CAAA;AAElC,IAAA,cAAoB,WAApB,oBAAoB,CAAA;AAEjC,MAAMA,SAAS,SAASC,cAAW,YAAA;IAChD,OAAOC,WAAW,GAAG,gDAAgD,CAAC;IAEtE,OAAOC,QAAQ,GAAG;QAAC,CAAC,SAAS,CAAC;KAAC,CAAC;IAEhC,OAAOC,IAAI,GAAG;QAAC;YAAEC,IAAI,EAAE,MAAM;SAAE;KAAC,CAAC;IAEjC,OAAOC,KAAK,GAAG;QACbC,MAAM,EAAEC,KAAK,MAAA,CAACC,MAAM,CAAC;YAAEP,WAAW,EAAE,0BAA0B;YAAEQ,OAAO,EAAE,gBAAgB;SAAE,CAAC;KAC7F,CAAC;IAEFC,YAAYC,IAAc,EAAEL,MAAc,CAAE;QAC1C,KAAK,CAACK,IAAI,EAAEL,MAAM,EAAE;YAAEF,IAAI,EAAE,MAAM;SAAE,CAAC,CAAC;KACvC;IAED,MAAMQ,GAAG,GAAG;QACV,MAAM,EAAET,IAAI,CAAA,EAAEE,KAAK,CAAA,EAAE,GAAG,MAAM,IAAI,CAACQ,KAAK,CAACd,SAAS,CAAC,AAAC;QAEpD,MAAMe,OAAO,GAAG;YACd,CAAC,gHAAgH,CAAC;YAClH,CAAC,EAAET,KAAK,CAACC,MAAM,GAAG,WAAW,GAAGD,KAAK,CAACC,MAAM,GAAG,EAAE,CAAC,CAAC;YACnD,CAAC,EAAEH,IAAI,CAACA,IAAI,IAAI,SAAS,CAAC,CAAC;SAC5B,CAACY,IAAI,CAAC,GAAG,CAAC,AAAC;QAEZ,IAAI,CAACC,GAAG,CAAC,CAAC,SAAS,EAAEF,OAAO,CAAC,CAAC,CAAC,CAAC;QAEhC,MAAMG,GAAG,GAAGC,CAAAA,GAAAA,aAAS,AAInB,CAAA,UAJmB,CAACJ,OAAO,EAAE;YAC7BK,KAAK,EAAEC,CAAAA,GAAAA,cAAmB,AAAE,CAAA,oBAAF,EAAE;YAC5BC,KAAK,EAAE;gBAAC,SAAS;gBAAE,SAAS;gBAAE,SAAS;aAAC;YACxCC,GAAG,EAAEC,OAAO,CAACD,GAAG;SACjB,CAAC,AAAC;KACJ;CACF;kBAhCoBvB,SAAS"}